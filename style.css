const commentList = document.getElementById("commentList");
const commentInput = document.getElementById("commentInput");
let userName = "Anonymous";

// Firebase
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "XXXX",
  appId: "XXXX"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Submit name popup
function submitName() {
  const input = document.getElementById("popupNameInput").value.trim();
  userName = input !== "" ? input : "Anonymous";
  document.getElementById("namePopup").remove();
}

// Add comment
function addComment() {
  const text = commentInput.value.trim();
  if (!text) return alert("Write a comment first!");
  
  db.collection("comments").add({
    name: userName,
    text: text,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });

  commentInput.value = "";
}

// Real-time listener
db.collection("comments").orderBy("timestamp").onSnapshot(snapshot => {
  commentList.innerHTML = "";
  snapshot.forEach(doc => {
    const data = doc.data();
    const li = document.createElement("li");
    const time = data.timestamp ? data.timestamp.toDate().toLocaleString() : "";

    li.innerHTML = `
      <span class="comment-name">${data.name}</span>: ${data.text}
      <div class="comment-time">${time}</div>
    `;
    commentList.appendChild(li);

    // Auto-delete 24hr
    const now = new Date().getTime();
    const msgTime = data.timestamp ? data.timestamp.toDate().getTime() : now;
    if (now - msgTime > 24*60*60*1000) {
      doc.ref.delete();
    }
  });
  commentList.scrollTop = commentList.scrollHeight;
});


